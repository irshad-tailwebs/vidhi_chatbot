<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8fafc;
        }
        .chatbox {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .message {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            word-wrap: break-word;
        }
        .bot-message {
            background-color: #e5e7eb;
            color: #1f2937;
        }
        .user-message {
            background-color: #10b981;
            color: white;
            text-align: right;
        }
        #error-message {
            color: red;
            margin-top: 10px;
        }
        .bot-response-container {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .response-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .info-section {
            color: #2d3748;
            line-height: 1.6;
        }
        .consequences-section {
            background-color: #edf2f7;
            padding: 12px;
            border-left: 4px solid #4299e1;
            border-radius: 4px;
            margin: 8px 0;
        }
        .disclaimer-section {
            color: #718096;
            font-style: italic;
            border-top: 1px solid #e2e8f0;
            padding-top: 12px;
            margin-top: 8px;
        }
        .bot-message {
            background-color: transparent;
            color: #1f2937;
            max-width: 80%;
            margin-left: 0;
            text-align: left;
        }
        .user-message {
            background-color: #10b981;
            color: white;
            max-width: 80%;
            margin-left: auto;
            text-align: right;
            padding: 12px;
            border-radius: 12px;
        }
        #chat-container {
            scroll-behavior: smooth;
            height: calc(100vh - 160px); /* Adjust for header and input area */
        }
        @media (max-width: 640px) {
            .chatbox {
                height: 100vh;
                max-width: 100%;
                margin: 0;
                padding: 0;
                border-radius: 0;
                display: flex;
                flex-direction: column;
            }
            #chat-container {
                flex-grow: 1;
                height: calc(100vh - 140px);
            }
        }
        .message {
            margin-bottom: 16px;
        }
        .emoji {
            font-size: 1.2em;
            margin-right: 8px;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
<div class="chatbox bg-white p-10 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold mb-4 text-center">Legal Chatbot üèõÔ∏è</h2>
    <div id="chat-container" class="space-y-4 mb-4 h-full overflow-y-auto">
        <!-- Messages will appear here -->
    </div>
    <div id="error-message" class="text-center"></div>
    <div class="flex space-x-2">
        <input 
            type="text" 
            id="user-query" 
            class="flex-grow p-2 border border-gray-300 rounded-lg" 
            placeholder="Ask your legal question..."
            onkeypress="handleKeyPress(event)"
        />
        <button 
            id="send-button" 
            class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
            onclick="sendQuery()"
        >
            Send
        </button>
    </div>
</div>

<script>
    const sendButton = document.getElementById('send-button');
    const userQueryInput = document.getElementById('user-query');
    const chatContainer = document.getElementById('chat-container');
    const errorMessageElement = document.getElementById('error-message');

    function displayMessage(message, isBot = true) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message');
        messageElement.classList.add(isBot ? 'bot-message' : 'user-message');

        // If it's a bot message with multiple responses (separated by --)
        if (isBot && message.includes('--------------------------------------------------')) {
            const responses = message.split('--------------------------------------------------');
            
            responses.forEach((response) => {
                if (response.trim()) {
                    const responseContainer = document.createElement('div');
                    responseContainer.classList.add('bot-response-container');

                    // Parse and format the response
                    const formattedResponse = formatBotResponse(response.trim());
                    responseContainer.innerHTML = formattedResponse;

                    messageElement.appendChild(responseContainer);
                }
            });
        } else {
            messageElement.textContent = message;
        }

        chatContainer.appendChild(messageElement);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function formatBotResponse(response) {
        // Split the response into sections
        const sections = response.split('\n\n');
        let html = '<div class="response-content">';

        sections.forEach((section) => {
            if (section.trim()) {
                if (section.includes("consequences may include")) {
                    html += `<div class="consequences-section">${section}</div>`;
                } else if (section.includes("‚öñÔ∏è")) {
                    html += `<div class="disclaimer-section">${section}</div>`;
                } else {
                    html += `<div class="info-section">${section}</div>`;
                }
            }
        });

        html += '</div>';
        return html;
    }

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            sendQuery();
        }
    }

    async function sendQuery() {
        const userQuery = userQueryInput.value.trim();
        if (!userQuery) return;

        // Reset previous error
        errorMessageElement.textContent = '';

        // Display user's message
        displayMessage(userQuery, false);
        userQueryInput.value = '';

        try {
            // More flexible URL configuration
            const backendUrl = 'http://127.0.0.1:5000/ask';
            const response = await axios.post(backendUrl, {
                query: userQuery
            }, {
                headers: {
                    'Content-Type': 'application/json'
                },
                timeout: 10000  // 10 second timeout
            });

            const botResponse = response.data.response || "Sorry, no response found.";
            displayMessage(botResponse);

        } catch (error) {
            console.error("Detailed error:", error);
            
            let errorMessage = "An error occurred. ";
            if (error.response) {
                // The request was made and the server responded with a status code
                errorMessage += `Server responded with ${error.response.status}: ${error.response.data.error || ''}`;
            } else if (error.request) {
                // The request was made but no response was received
                errorMessage += "No response received from the server. Check your backend is running.";
            } else {
                // Something happened in setting up the request
                errorMessage += error.message;
            }

            errorMessageElement.textContent = errorMessage;
            displayMessage("Sorry, there was a problem connecting to the legal chatbot.", true);
        }
    }

    // Optional: Add initial welcome message
    document.addEventListener('DOMContentLoaded', () => {
        displayMessage("Hi! I'm a legal assistant. Ask me about laws and regulations.");
    });
</script>
</body>
</html>